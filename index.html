<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Argentina Salary Calculator 2025 | Executive Edition</title>
    <style>
        :root {
            --primary: #004481;
            --secondary: #2DCCCD;
            --bg: #F4F6F8;
            --text: #333;
            --border: #E0E0E0;
            --hint: #666;
            --link: #004481;
            --accent-bg: #E8F0FE;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 40px 20px; display: flex; justify-content: center; }
        .container { max-width: 1000px; width: 100%; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.06); overflow: hidden; display: flex; flex-direction: column; }
        
        /* Header */
        .header { background: var(--primary); color: white; padding: 30px 40px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 24px; font-weight: 500; }
        .header p { margin: 5px 0 0; opacity: 0.8; font-size: 14px; }
        
        .lang-switch { display: flex; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; overflow: hidden; }
        .lang-opt { font-size: 12px; font-weight: 700; padding: 6px 12px; cursor: pointer; transition: 0.2s; color: rgba(255,255,255,0.7); }
        .lang-opt:hover { background: rgba(255,255,255,0.1); color: white; }
        .lang-opt.active { background: white; color: var(--primary); }

        /* Layout */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; border-bottom: 1px solid var(--border); }
        @media (max-width: 850px) { .main-grid { grid-template-columns: 1fr; } }

        /* Inputs Section */
        .inputs { padding: 40px; border-right: 1px solid var(--border); background: #fff; }
        
        /* Controls */
        .toggle-container { display: flex; background: #f5f5f5; padding: 4px; border-radius: 8px; margin-bottom: 30px; }
        .toggle-opt { flex: 1; text-align: center; padding: 12px; cursor: pointer; font-size: 14px; font-weight: 600; border-radius: 6px; color: #666; transition: 0.2s; }
        .toggle-opt.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .row { display: flex; gap: 20px; margin-bottom: 20px; }
        .col { flex: 1; }
        
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 8px; color: #444; }
        .input-wrap { position: relative; }
        .input-prefix { position: absolute; left: 12px; top: 12px; color: #999; font-size: 14px; pointer-events: none; }
        
        input, select { width: 100%; padding: 10px 10px 10px 35px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px; transition: 0.2s; box-sizing: border-box; height: 42px; }
        input:focus, select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(0,68,129,0.1); }
        
        /* Helpers */
        .smart-hint { font-size: 11px; color: var(--hint); margin-top: 6px; display: flex; justify-content: space-between; align-items: center; min-height: 18px; }
        .apply-btn { color: var(--primary); background: var(--accent-bg); padding: 2px 8px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 10px; border: none; transition: 0.2s; }
        .apply-btn:hover { background: #d0e1fd; }

        /* Collapsible Sections */
        .collapsible-box { border: 1px solid var(--border); border-radius: 8px; margin-bottom: 15px; overflow: hidden; }
        .collapsible-header { padding: 12px 20px; background: #fcfcfc; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 13px; color: #555; transition: 0.2s; }
        .collapsible-header:hover { background: #f0f0f0; }
        .collapsible-body { padding: 20px; display: none; border-top: 1px solid var(--border); background: white; }
        .collapsible-body.open { display: block; }

        .btn-calc { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer; transition: 0.2s; margin-top: 15px; }
        .btn-calc:hover { background: #003366; box-shadow: 0 4px 12px rgba(0,68,129,0.2); }

        /* Results Section */
        .results { padding: 40px; background: #F9FAFB; display: flex; flex-direction: column; }
        .summary-card { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .summary-label { font-size: 12px; font-weight: 700; color: #999; text-transform: uppercase; letter-spacing: 1px; }
        .summary-value { font-size: 48px; color: var(--primary); font-weight: 700; margin: 10px 0; line-height: 1; letter-spacing: -1px; }
        .summary-sub { font-size: 16px; color: #666; font-weight: 500; }

        .report-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .report-table th { text-align: right; color: #999; font-weight: 600; padding: 12px; border-bottom: 1px solid #ddd; font-size: 11px; text-transform: uppercase; }
        .report-table th:first-child { text-align: left; }
        .report-table td { padding: 12px; border-bottom: 1px solid #eee; text-align: right; color: #333; }
        .report-table td:first-child { text-align: left; font-weight: 500; color: #444; }
        .report-table tr:last-child td { border-bottom: none; }
        .report-table .total-row td { font-weight: 700; color: #222; border-top: 2px solid #ddd; font-size: 15px; background: rgba(0,0,0,0.01); }
        
        .tag-info { display: inline-block; font-size: 10px; background: #eee; padding: 2px 6px; border-radius: 4px; color: #666; margin-left: 5px; vertical-align: middle; }

        .disclaimer { margin-top: auto; font-size: 12px; color: #888; padding-top: 20px; border-top: 1px solid #e0e0e0; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <h1 data-i18n="app_title">Argentina Salary Calculator</h1>
            <p data-i18n="app_subtitle">Executive & Standard • Dec 2025 Projection</p>
        </div>
        <div class="header-controls">
            <div class="lang-switch">
                <div class="lang-opt active" onclick="changeLanguage('en')">EN</div>
                <div class="lang-opt" onclick="changeLanguage('es')">ES</div>
            </div>
        </div>
    </div>

    <div class="main-grid">
        <div class="inputs">
            <div class="toggle-container">
                <div class="toggle-opt active" id="btn-monthly" onclick="setMode('monthly')" data-i18n="btn_monthly">Monthly Salary</div>
                <div class="toggle-opt" id="btn-annual" onclick="setMode('annual')" data-i18n="btn_annual">Annual Package</div>
            </div>

            <div class="row">
                <div class="col">
                    <label data-i18n="lbl_currency">Currency</label>
                    <div class="input-wrap">
                        <select id="currency" onchange="toggleRateInput()">
                            <option value="ARS">ARS - Pesos</option>
                            <option value="USD">USD - Dollars</option>
                            <option value="EUR">EUR - Euros</option>
                        </select>
                    </div>
                </div>
                <div class="col" id="rate-col" style="display:none;">
                    <label data-i18n="lbl_exchange">Exchange Rate</label>
                    <div class="input-wrap">
                        <span class="input-prefix">$</span>
                        <input type="text" id="exchange-rate" placeholder="1680" onkeyup="updateHints()">
                    </div>
                </div>
            </div>

            <div class="input-wrap" style="margin-bottom: 25px;">
                <label id="salary-label" data-i18n="lbl_gross_monthly">Gross Monthly Salary</label>
                <div class="input-wrap">
                    <span class="input-prefix" id="salary-symbol">$</span>
                    <input type="text" id="salary-input" placeholder="0" onkeyup="updateHints()">
                </div>
            </div>

            <span class="section-label" style="font-size:11px; font-weight:700; color:#999; text-transform:uppercase; display:block; margin-bottom:10px;" data-i18n="sec_config">Configuration</span>

            <div class="row">
                <div class="col">
                    <label data-i18n="lbl_spouse">Spouse (No Income)</label>
                    <select id="spouse" onchange="updateHints()">
                        <option value="0" data-i18n="opt_no">No</option>
                        <option value="1" data-i18n="opt_yes">Yes</option>
                    </select>
                </div>
                <div class="col">
                    <label data-i18n="lbl_children">Children (< 18)</label>
                    <div class="input-wrap">
                        <span class="input-prefix">#</span>
                        <input type="number" id="children" value="0" min="0" onchange="updateHints()">
                    </div>
                </div>
            </div>

            <div class="collapsible-box">
                <div class="collapsible-header" onclick="toggleSection('extra-body', 'arrow-extra')">
                    <span data-i18n="header_extras">Overtime & Union</span>
                    <span id="arrow-extra">▼</span>
                </div>
                <div class="collapsible-body" id="extra-body">
                    <div class="row">
                        <div class="col">
                            <label data-i18n="lbl_union">Union / Other (%)</label>
                            <div class="input-wrap">
                                <span class="input-prefix">%</span>
                                <input type="number" id="union-pct" placeholder="0" step="0.1">
                            </div>
                            <div class="smart-hint" data-i18n="hint_union">Usually 2% - 4%</div>
                        </div>
                        <div class="col">
                             <label data-i18n="lbl_overtime_hrs">Overtime Hours (50%)</label>
                             <div class="input-wrap">
                                 <span class="input-prefix">Hrs</span>
                                 <input type="number" id="overtime-50" placeholder="0">
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="collapsible-box">
                <div class="collapsible-header" onclick="toggleSection('deduction-body', 'arrow-ded')">
                    <span data-i18n="header_deductions">Income Tax Deductions</span>
                    <span id="arrow-ded">▼</span>
                </div>
                <div class="collapsible-body" id="deduction-body">
                    <div class="row">
                        <div class="col">
                            <label data-i18n="lbl_domestic">Domestic Staff (Mo)</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-domestic" placeholder="0"></div>
                            <div class="smart-hint" id="hint-container-domestic">
                                <span class="hint-text">Cap: <span id="hint-domestic">-</span>/yr</span>
                                <button class="apply-btn" onclick="applyMax('ded-domestic', 'val-domestic')" data-i18n="btn_max">Max</button>
                            </div>
                        </div>
                        <div class="col">
                            <label data-i18n="lbl_rent">Rent Paid (Mo)</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-rent" placeholder="0"></div>
                            <div class="smart-hint">
                                <span class="hint-text">Cap: 40% GNI</span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label data-i18n="lbl_health">Prepaga (Diff)</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-health" placeholder="0"></div>
                            <div class="smart-hint" id="hint-container-health">
                                <span class="hint-text">Cap 5% Net: <span id="hint-health">-</span></span>
                            </div>
                        </div>
                        <div class="col">
                            <label data-i18n="lbl_life">Life Insurance</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-life" placeholder="0"></div>
                            <div class="smart-hint" id="hint-container-life">
                                <span class="hint-text">Cap: <span id="hint-life">-</span>/yr</span>
                                <button class="apply-btn" onclick="applyMax('ded-life', 'val-life')" data-i18n="btn_max">Max</button>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label data-i18n="lbl_edu">Education</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-edu" placeholder="0"></div>
                            <div class="smart-hint" id="hint-container-edu">
                                <span class="hint-text">Cap: <span id="hint-edu">-</span>/yr</span>
                                <button class="apply-btn" onclick="applyMax('ded-edu', 'val-edu')" data-i18n="btn_max">Max</button>
                            </div>
                        </div>
                        <div class="col"></div>
                    </div>
                </div>
            </div>

            <button class="btn-calc" onclick="calculate()" data-i18n="btn_calc">Calculate Compensation</button>
        </div>

        <div class="results">
            <div class="summary-card">
                <div class="summary-label" data-i18n="res_label_net">Standard Monthly Net</div>
                <div class="summary-value" id="res-net-main">-</div>
                <div class="summary-sub" id="res-net-sec"></div>
            </div>

            <table class="report-table">
                <thead>
                    <tr>
                        <th data-i18n="th_concept">Concept</th>
                        <th data-i18n="th_monthly">Standard Month</th>
                        <th data-i18n="th_annual">Annual Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-i18n="row_gross">Gross Salary</td>
                        <td id="tbl-gross-m">-</td>
                        <td id="tbl-gross-a">-</td>
                    </tr>
                    <tr id="row-overtime" style="display:none;">
                        <td data-i18n="row_overtime">Overtime (+)</td>
                        <td id="tbl-overtime-m">-</td>
                        <td id="tbl-overtime-a">-</td>
                    </tr>
                    <tr>
                        <td>SAC (Aguinaldo) <span class="tag-info">Jun/Dec</span></td>
                        <td id="tbl-sac-m" style="color:#aaa;">-</td>
                        <td id="tbl-sac-a">-</td>
                    </tr>
                    <tr>
                        <td data-i18n="row_social">Social Security <span class="tag-info">17%</span></td>
                        <td id="tbl-social-m" style="color:#D32F2F">-</td>
                        <td id="tbl-social-a" style="color:#D32F2F">-</td>
                    </tr>
                    <tr id="row-union" style="display:none;">
                        <td data-i18n="row_union">Union / Other</td>
                        <td id="tbl-union-m" style="color:#D32F2F">-</td>
                        <td id="tbl-union-a" style="color:#D32F2F">-</td>
                    </tr>
                    <tr>
                        <td data-i18n="row_tax">Income Tax (Ganancias)</td>
                        <td id="tbl-tax-m" style="color:#D32F2F">-</td>
                        <td id="tbl-tax-a" style="color:#D32F2F">-</td>
                    </tr>
                    <tr class="total-row">
                        <td data-i18n="row_net">Net Pocket Money</td>
                        <td id="tbl-net-m" style="color:var(--primary)">-</td>
                        <td id="tbl-net-a" style="color:var(--primary)">-</td>
                    </tr>
                </tbody>
            </table>

            <div class="disclaimer">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <div><strong data-i18n="lbl_taxable_base">Taxable Base:</strong> <span id="info-tax-base">-</span></div>
                    <div><strong data-i18n="lbl_marginal">Marginal Rate:</strong> <span id="info-marginal">-</span></div>
                </div>
                <span data-i18n="disclaimer_text">Calculations are orientative. Values are based on the December 2025 projection (ARCA/IPC). Actual values may vary based on exact payment dates and union agreements.</span>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. CONSTANTS (DEC 2025 UPDATE) ---
    const TAX_DATA = {
        SOCIAL: {
            CAP_BASE: 3731212.01,
            RATE: 0.17
        },
        OVERTIME: {
            DIVISOR: 160, 
            RATE_50: 1.5
        },
        GANANCIAS: {
            // Accumulated values for 2nd Semester 2025
            // We multiply by 2 to project an "Annual" equivalent for the calculation
            MULT: 2, 
            GNI: 4211886.94,
            DED_SPECIAL: 20217057.35,
            DED_SPOUSE: 3966752.72,
            DED_CHILD: 2000447.87,
            CAP_LIFE: 573817.13 * 2,
            
            // 2nd Semester 2025 Accumulated Scale
            BRACKETS: [
                { limit: 1635136.56, rate: 0.05 },
                { limit: 3270273.12, rate: 0.09 },
                { limit: 4905409.68, rate: 0.12 },
                { limit: 7358114.52, rate: 0.15 },
                { limit: 14716229.04, rate: 0.19 },
                { limit: 22074343.56, rate: 0.23 },
                { limit: 33111515.34, rate: 0.27 },
                { limit: 49667273.02, rate: 0.31 },
                { limit: Infinity, rate: 0.35 }
            ]
        }
    };

    const i18n = {
        en: {
            app_title: "Argentina Salary Calculator",
            app_subtitle: "Executive & Standard • Dec 2025 Projection",
            btn_monthly: "Monthly Salary",
            btn_annual: "Annual Package",
            lbl_currency: "Currency",
            lbl_exchange: "Exchange Rate (ARS)",
            lbl_gross_monthly: "Gross Monthly Salary",
            lbl_gross_annual: "Gross Annual Package",
            sec_config: "Configuration",
            lbl_spouse: "Spouse (No Income)",
            opt_no: "No",
            opt_yes: "Yes",
            lbl_children: "Children (< 18)",
            header_extras: "Overtime & Union",
            lbl_union: "Union / Other (%)",
            hint_union: "Usually 2% - 4%",
            lbl_overtime_hrs: "Overtime Hours (50%)",
            header_deductions: "Income Tax Deductions",
            lbl_domestic: "Domestic Staff (Mo)",
            lbl_rent: "Rent Paid (Mo)",
            lbl_health: "Prepaga (Diff)",
            lbl_life: "Life Insurance",
            lbl_edu: "Education",
            btn_max: "Max",
            btn_calc: "Calculate",
            res_label_net: "Standard Monthly Net",
            th_concept: "Concept",
            th_monthly: "Standard Month",
            th_annual: "Annual Total",
            row_gross: "Gross Salary",
            row_overtime: "Overtime (+)",
            row_social: "Social Security",
            row_union: "Union / Other",
            row_tax: "Income Tax (Ganancias)",
            row_net: "Net Pocket Money",
            lbl_taxable_base: "Taxable Annual Base:",
            lbl_marginal: "Marginal Rate:",
            disclaimer_text: "Calculations are orientative. Values are based on the December 2025 projection (ARCA/IPC). Actual values may vary based on exact payment dates and union agreements."
        },
        es: {
            app_title: "Calculadora de Sueldo",
            app_subtitle: "Ejecutivo y Estándar • Proyección Dic 2025",
            btn_monthly: "Sueldo Mensual",
            btn_annual: "Paquete Anual",
            lbl_currency: "Moneda",
            lbl_exchange: "Tipo de Cambio",
            lbl_gross_monthly: "Sueldo Bruto Mensual",
            lbl_gross_annual: "Paquete Bruto Anual",
            sec_config: "Configuración",
            lbl_spouse: "Cónyuge (Sin ingresos)",
            opt_no: "No",
            opt_yes: "Sí",
            lbl_children: "Hijos (< 18)",
            header_extras: "Horas Extras y Sindicato",
            lbl_union: "Sindicato / Otros (%)",
            hint_union: "Gralmente 2% - 4%",
            lbl_overtime_hrs: "Horas Extras (50%)",
            header_deductions: "Deducciones de Ganancias",
            lbl_domestic: "Servicio Doméstico (Mes)",
            lbl_rent: "Alquiler (Mes)",
            lbl_health: "Prepaga (Excedente)",
            lbl_life: "Seguro de Vida",
            lbl_edu: "Educación",
            btn_max: "Tope",
            btn_calc: "Calcular",
            res_label_net: "Neto Mensual Estimado",
            th_concept: "Concepto",
            th_monthly: "Mes Estándar",
            th_annual: "Total Anual",
            row_gross: "Sueldo Bruto",
            row_overtime: "Horas Extras (+)",
            row_social: "Cargas Sociales",
            row_union: "Sindicato / Otros",
            row_tax: "Impuesto a las Ganancias",
            row_net: "En Mano (Neto)",
            lbl_taxable_base: "Base Imponible Anual:",
            lbl_marginal: "Alícuota Marginal:",
            disclaimer_text: "El resultado es orientativo. Valores basados en proyección Dic 2025 (ARCA). Puede variar según fecha de pago y convenios."
        }
    };

    let currentLang = 'en';
    let inputMode = 'monthly';
    let dynamicCaps = { 'val-domestic': 0, 'val-health': 0, 'val-edu': 0, 'val-life': 0 };

    function changeLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-opt').forEach(el => el.classList.remove('active'));
        document.querySelector(`.lang-opt[onclick="changeLanguage('${lang}')"]`).classList.add('active');
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if(i18n[lang][key]) el.innerText = i18n[lang][key];
        });
        const labelKey = inputMode === 'annual' ? 'lbl_gross_annual' : 'lbl_gross_monthly';
        document.getElementById('salary-label').innerText = i18n[lang][labelKey];
        updateHints();
    }

    function setMode(mode) {
        inputMode = mode;
        document.querySelectorAll('.toggle-opt').forEach(el => el.classList.remove('active'));
        document.querySelector(`#btn-${mode}`).classList.add('active');
        const labelKey = mode === 'annual' ? 'lbl_gross_annual' : 'lbl_gross_monthly';
        document.getElementById('salary-label').innerText = i18n[currentLang][labelKey];
        updateHints();
    }

    function toggleRateInput() {
        const curr = document.getElementById('currency').value;
        document.getElementById('rate-col').style.display = curr === 'ARS' ? 'none' : 'block';
        document.getElementById('salary-symbol').innerText = curr === 'EUR' ? '€' : '$';
        updateHints();
    }

    function toggleSection(bodyId, arrowId) {
        const body = document.getElementById(bodyId);
        body.classList.toggle('open');
        document.getElementById(arrowId).innerText = body.classList.contains('open') ? '▲' : '▼';
    }

    function parseNumber(val) {
        if (!val) return 0;
        let clean = val.toString().replace(/\./g, '').replace(/,/g, '.');
        return parseFloat(clean) || 0;
    }

    function formatCurrency(val, currency = 'ARS') {
        const locale = 'es-AR'; // Always use AR format for dots/commas
        return new Intl.NumberFormat(locale, { style: 'currency', currency: currency, maximumFractionDigits: 0 }).format(val);
    }

    function updateHints() {
        const fmt = (n) => formatCurrency(n, 'ARS');
        const G = TAX_DATA.GANANCIAS;
        const gniAnnual = G.GNI * G.MULT;

        // Caps
        dynamicCaps['val-domestic'] = gniAnnual / 12;
        dynamicCaps['val-life'] = G.CAP_LIFE / 12;
        dynamicCaps['val-edu'] = (gniAnnual * 0.40) / 12; // 40% GNI

        setHintText('hint-domestic', 'hint-container-domestic', fmt(gniAnnual));
        setHintText('hint-life', 'hint-container-life', fmt(G.CAP_LIFE));
        setHintText('hint-edu', 'hint-container-edu', fmt(gniAnnual * 0.40));
    }

    function setHintText(spanId, containerId, text) {
        document.getElementById(spanId).innerText = text;
    }

    function applyMax(inputId, valKey) {
        const val = dynamicCaps[valKey];
        if (val > 0) {
            document.getElementById(inputId).value = new Intl.NumberFormat('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(val);
        } else {
            alert("No limit available.");
        }
    }

    function calculate() {
        // 1. INPUTS
        const currency = document.getElementById('currency').value;
        const salaryInput = parseNumber(document.getElementById('salary-input').value);
        const rate = parseNumber(document.getElementById('exchange-rate').value) || 1;
        if(salaryInput === 0) return;

        // 2. NORMALIZE GROSS
        const rawArs = currency === 'ARS' ? salaryInput : salaryInput * rate;
        let monthlyGrossBase;

        // Logic: Annual Package usually includes SAC. Monthly doesn't.
        if (inputMode === 'annual') {
            monthlyGrossBase = rawArs / 13; // 12 months + 1 SAC
        } else {
            monthlyGrossBase = rawArs;
        }

        // 3. OVERTIME
        const otHours = parseFloat(document.getElementById('overtime-50').value) || 0;
        let otAmountMonthly = 0;
        if (otHours > 0) {
            const hourlyRate = monthlyGrossBase / TAX_DATA.OVERTIME.DIVISOR;
            otAmountMonthly = hourlyRate * TAX_DATA.OVERTIME.RATE_50 * otHours;
        }
        
        const totalMonthlyGross = monthlyGrossBase + otAmountMonthly;
        const sacAmount = totalMonthlyGross; // One full extra salary
        const annualGrossTotal = (totalMonthlyGross * 12) + sacAmount;

        // 4. SOCIAL SECURITY (Capped)
        // Monthly
        const ssBaseMonthly = Math.min(totalMonthlyGross, TAX_DATA.SOCIAL.CAP_BASE);
        const ssMonthly = ssBaseMonthly * TAX_DATA.SOCIAL.RATE;
        
        // SAC SS (Cap is 50% for each half, total is approx 1 month worth of capped SS)
        const ssSacBase = Math.min(sacAmount, TAX_DATA.SOCIAL.CAP_BASE); 
        const ssSacTotal = ssSacBase * TAX_DATA.SOCIAL.RATE;
        
        const ssAnnualTotal = (ssMonthly * 12) + ssSacTotal;

        // 5. UNION
        const unionPct = parseNumber(document.getElementById('union-pct').value);
        const unionMonthly = totalMonthlyGross * (unionPct / 100);
        const unionAnnual = unionMonthly * 13; 

        // 6. INCOME TAX (Annualized)
        // Net Cumulative
        const netCumulativeAnnual = annualGrossTotal - ssAnnualTotal - unionAnnual;

        // Deductions
        const G = TAX_DATA.GANANCIAS;
        const mult = G.MULT;
        
        const children = parseInt(document.getElementById('children').value) || 0;
        const hasSpouse = document.getElementById('spouse').value === "1";

        let dedPersonal = (G.GNI * mult) + (G.DED_SPECIAL * mult);
        if(hasSpouse) dedPersonal += (G.DED_SPOUSE * mult);
        dedPersonal += (children * (G.DED_CHILD * mult));

        // General Deductions
        const valDomestic = parseNumber(document.getElementById('ded-domestic').value) * 12;
        const valRent = parseNumber(document.getElementById('ded-rent').value) * 12;
        const valEdu = parseNumber(document.getElementById('ded-edu').value) * 12;
        const valLife = parseNumber(document.getElementById('ded-life').value) * 12;
        const valHealth = parseNumber(document.getElementById('ded-health').value) * 12;

        const dedDomestic = Math.min(valDomestic, (G.GNI * mult));
        const dedEdu = Math.min(valEdu, (G.GNI * mult) * 0.40);
        const dedRent = Math.min(valRent * 0.10, (G.GNI * mult) * 0.40); // 10% of rent, cap 40% GNI
        const dedLife = Math.min(valLife, G.CAP_LIFE);

        // Health Cap Calc
        const baseForHealthCap = netCumulativeAnnual - dedPersonal - dedDomestic - dedEdu - dedRent - dedLife;
        const healthCap = Math.max(0, baseForHealthCap * 0.05);
        const dedHealth = Math.min(valHealth, healthCap);
        
        // Update Health Hint dynamically
        document.getElementById('hint-health').innerText = formatCurrency(healthCap / 12, 'ARS');

        const totalDeductions = dedPersonal + dedDomestic + dedEdu + dedRent + dedLife + dedHealth;
        const taxableIncomeAnnual = Math.max(0, netCumulativeAnnual - totalDeductions);

        // Tax Calculation
        const taxRes = calculateTax(taxableIncomeAnnual, G.BRACKETS, mult);
        const taxAnnual = taxRes.tax;
        const taxMonthly = taxAnnual / 12; // Distributed retention

        // 7. FINAL NET
        const totalDedMonthly = ssMonthly + unionMonthly + taxMonthly;
        const netMonthly = totalMonthlyGross - totalDedMonthly;
        const netAnnual = annualGrossTotal - ssAnnualTotal - unionAnnual - taxAnnual;

        // 8. RENDER
        const fmtArs = (n) => formatCurrency(n, 'ARS');
        const fmtForeign = (n) => formatCurrency(n, currency);

        // Big Display
        if(currency === 'ARS') {
            document.getElementById('res-net-main').innerText = fmtArs(netMonthly);
            document.getElementById('res-net-sec').innerText = "";
        } else {
            document.getElementById('res-net-main').innerText = fmtForeign(netMonthly / rate);
            document.getElementById('res-net-sec').innerText = "≈ " + fmtArs(netMonthly);
        }

        // Table
        setText('tbl-gross-m', fmtArs(monthlyGrossBase));
        setText('tbl-gross-a', fmtArs(monthlyGrossBase * 12 + sacAmount)); // Approx for display

        if(otAmountMonthly > 0) {
            document.getElementById('row-overtime').style.display = 'table-row';
            setText('tbl-overtime-m', fmtArs(otAmountMonthly));
            setText('tbl-overtime-a', fmtArs(otAmountMonthly * 12)); // Approx
        } else {
            document.getElementById('row-overtime').style.display = 'none';
        }

        setText('tbl-sac-m', "-");
        setText('tbl-sac-a', fmtArs(sacAmount));

        setText('tbl-social-m', fmtArs(ssMonthly));
        setText('tbl-social-a', fmtArs(ssAnnualTotal));

        if(unionMonthly > 0) {
            document.getElementById('row-union').style.display = 'table-row';
            setText('tbl-union-m', fmtArs(unionMonthly));
            setText('tbl-union-a', fmtArs(unionAnnual));
        } else {
            document.getElementById('row-union').style.display = 'none';
        }

        setText('tbl-tax-m', fmtArs(taxMonthly));
        setText('tbl-tax-a', fmtArs(taxAnnual));

        setText('tbl-net-m', fmtArs(netMonthly));
        setText('tbl-net-a', fmtArs(netAnnual));

        // Info
        setText('info-tax-base', fmtArs(taxableIncomeAnnual));
        setText('info-marginal', (taxRes.rate * 100).toFixed(0) + "%");
    }

    function calculateTax(income, brackets, multiplier) {
        if (income <= 0) return { tax: 0, rate: 0 };
        let tax = 0;
        let rate = 0;
        let prevLimit = 0;
        
        for (let b of brackets) {
            // Adjust limit for annual projection
            let limit = b.limit === Infinity ? Infinity : b.limit * multiplier;
            
            if (income > limit) {
                tax += (limit - prevLimit) * b.rate;
                prevLimit = limit;
            } else {
                tax += (income - prevLimit) * b.rate;
                rate = b.rate;
                break;
            }
            rate = b.rate; // top bracket case
        }
        return { tax, rate };
    }

    function setText(id, val) { document.getElementById(id).innerText = val; }

    // Input Masking
    document.querySelectorAll('input[type="text"]').forEach(input => {
        input.addEventListener('input', (e) => {
            let val = e.target.value.replace(/[^0-9,]/g, ''); 
            let parts = val.split(',');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            e.target.value = parts.join(',');
        });
    });

    updateHints();
</script>

</body>
</html>
