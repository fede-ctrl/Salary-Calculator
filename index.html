<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Compensation | Argentina 2025</title>
    <style>
        :root {
            --primary: #004481;
            --secondary: #2DCCCD;
            --bg: #F4F6F8;
            --text: #222;
            --border: #E0E0E0;
            --hint: #666;
            --link: #1973B8;
            --warning: #FFF3CD;
            --warning-text: #856404;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 40px 20px; display: flex; justify-content: center; }
        .container { max-width: 1100px; width: 100%; background: white; border-radius: 12px; box-shadow: 0 15px 40px rgba(0,0,0,0.08); overflow: hidden; display: flex; flex-direction: column; }
        
        /* Header */
        .header { background: var(--primary); color: white; padding: 35px 40px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 22px; font-weight: 400; letter-spacing: 0.5px; }
        .header-controls { display: flex; align-items: center; gap: 15px; }
        
        .lang-switch { display: flex; border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; overflow: hidden; }
        .lang-opt { font-size: 11px; font-weight: 700; padding: 5px 10px; cursor: pointer; transition: 0.2s; color: rgba(255,255,255,0.7); }
        .lang-opt:hover { background: rgba(255,255,255,0.1); color: white; }
        .lang-opt.active { background: white; color: var(--primary); }

        /* Grid */
        .main-grid { display: grid; grid-template-columns: 1.1fr 0.9fr; border-bottom: 1px solid var(--border); }
        
        /* Inputs */
        .inputs { padding: 40px; border-right: 1px solid var(--border); background: #fff; }
        .row { display: flex; gap: 20px; margin-bottom: 25px; }
        .col { flex: 1; }
        
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 8px; color: #444; }
        .input-wrap { position: relative; }
        .input-prefix { position: absolute; left: 12px; top: 13px; color: #999; font-size: 14px; pointer-events: none; }
        
        input, select { width: 100%; padding: 12px 12px 12px 30px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px; transition: 0.2s; box-sizing: border-box; }
        input:focus, select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(0,68,129,0.1); }
        
        /* Hints */
        .smart-hint { font-size: 11px; color: var(--hint); margin-top: 6px; display: flex; justify-content: space-between; align-items: center; min-height: 16px; }
        .apply-link { color: var(--link); cursor: pointer; font-weight: 600; text-decoration: none; border-bottom: 1px dashed var(--link); }
        
        /* Toggles */
        .toggle-container { display: flex; background: #f0f0f0; padding: 4px; border-radius: 6px; margin-bottom: 25px; }
        .toggle-opt { flex: 1; text-align: center; padding: 10px; cursor: pointer; font-size: 14px; font-weight: 600; border-radius: 4px; color: #666; transition: 0.2s; }
        .toggle-opt.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* Sections */
        .section-label { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #999; font-weight: 700; display: block; margin-bottom: 15px; margin-top: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        /* Deductions / Advanced */
        .collapsible-box { border: 1px solid var(--border); border-radius: 8px; margin-bottom: 20px; background: #fff; }
        .collapsible-header { padding: 15px 20px; background: #f8f9fa; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 14px; }
        .collapsible-body { padding: 20px; display: none; border-top: 1px solid var(--border); }
        .collapsible-body.open { display: block; }

        .btn-calc { width: 100%; background: var(--primary); color: white; border: none; padding: 16px; font-size: 16px; font-weight: 600; border-radius: 6px; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn-calc:hover { background: #003366; }

        /* Results */
        .results { padding: 40px; background: #F9FAFB; display: flex; flex-direction: column; }
        .summary-card { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 25px; text-align: center; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .summary-label { font-size: 12px; font-weight: 700; color: #999; text-transform: uppercase; letter-spacing: 1px; }
        .summary-value { font-size: 42px; color: var(--primary); font-weight: 700; margin: 10px 0; line-height: 1; }
        .summary-sub { font-size: 18px; color: #666; font-weight: 500; }

        .report-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .report-table th { text-align: right; color: #888; font-weight: 600; padding: 10px; border-bottom: 1px solid #ddd; font-size: 12px; text-transform: uppercase; }
        .report-table th:first-child { text-align: left; }
        .report-table td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: right; color: #333; }
        .report-table td:first-child { text-align: left; font-weight: 500; color: #555; }
        .report-table tr:last-child td { border-bottom: none; }
        .report-table .total-row td { font-weight: 700; color: #D32F2F; border-top: 2px solid #eee; font-size: 15px; }
        
        .disclaimer { margin-top: auto; font-size: 12px; color: #999; padding-top: 20px; border-top: 1px solid #eee; line-height: 1.5; }

        @media (max-width: 850px) {
            .main-grid { grid-template-columns: 1fr; }
            .inputs { border-right: none; border-bottom: 1px solid var(--border); }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <h1 data-i18n="app_title">Executive Compensation</h1>
            <p style="margin:0; opacity:0.8; font-size:13px;" data-i18n="app_subtitle">Unified Market • Fiscal Year 2025</p>
        </div>
        <div class="header-controls">
            <div class="lang-switch">
                <div class="lang-opt active" onclick="changeLanguage('en')">EN</div>
                <div class="lang-opt" onclick="changeLanguage('es')">ES</div>
            </div>
        </div>
    </div>

    <div class="main-grid">
        <div class="inputs">
            <div class="toggle-container">
                <div class="toggle-opt active" id="btn-monthly" onclick="setMode('monthly')" data-i18n="btn_monthly">Monthly Salary</div>
                <div class="toggle-opt" id="btn-annual" onclick="setMode('annual')" data-i18n="btn_annual">Annual Package</div>
            </div>

            <div class="row">
                <div class="col">
                    <label data-i18n="lbl_currency">Currency</label>
                    <div class="input-wrap">
                        <select id="currency" onchange="toggleRateInput()">
                            <option value="ARS" data-i18n="opt_ars">ARS - Pesos</option>
                            <option value="USD" data-i18n="opt_usd">USD - Dollars</option>
                            <option value="EUR" data-i18n="opt_eur">EUR - Euros</option>
                        </select>
                    </div>
                </div>
                <div class="col" id="rate-col" style="display:none;">
                    <label data-i18n="lbl_exchange">Exchange Rate</label>
                    <div class="input-wrap">
                        <span class="input-prefix">$</span>
                        <input type="text" id="exchange-rate" placeholder="1250.50" onkeyup="updateHints()">
                    </div>
                </div>
            </div>

            <div class="input-wrap" style="margin-bottom: 25px;">
                <label id="salary-label" data-i18n="lbl_gross_monthly">Gross Monthly Salary</label>
                <div class="input-wrap">
                    <span class="input-prefix" id="salary-symbol">$</span>
                    <input type="text" id="salary-input" placeholder="0" onkeyup="updateHints()">
                </div>
            </div>

            <span class="section-label" data-i18n="sec_family">Family Configuration</span>
            <div class="row">
                <div class="col">
                    <label data-i18n="lbl_spouse">Spouse (No Income)</label>
                    <select id="spouse" onchange="updateHints()">
                        <option value="0" data-i18n="opt_no">No</option>
                        <option value="1" data-i18n="opt_yes">Yes</option>
                    </select>
                </div>
                <div class="col">
                    <label data-i18n="lbl_children">Children (< 18)</label>
                    <div class="input-wrap">
                        <span class="input-prefix">#</span>
                        <input type="number" id="children" value="0" min="0" onchange="updateHints()">
                    </div>
                </div>
            </div>

            <div class="collapsible-box">
                <div class="collapsible-header" onclick="toggleSection('extra-body', 'arrow-extra')">
                    <span data-i18n="header_extras">Overtime & Union</span>
                    <span id="arrow-extra">▼</span>
                </div>
                <div class="collapsible-body" id="extra-body">
                    <div class="row">
                        <div class="col">
                            <label data-i18n="lbl_union">Union / Other (%)</label>
                            <div class="input-wrap">
                                <span class="input-prefix">%</span>
                                <input type="number" id="union-pct" placeholder="0" step="0.1">
                            </div>
                            <div class="smart-hint" data-i18n="hint_union">Usually 2% - 4%</div>
                        </div>
                        <div class="col">
                             <label data-i18n="lbl_overtime_hrs">Overtime Hours (50%)</label>
                             <div class="input-wrap">
                                 <span class="input-prefix">Hrs</span>
                                 <input type="number" id="overtime-50" placeholder="0">
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="collapsible-box">
                <div class="collapsible-header" onclick="toggleSection('deduction-body', 'arrow-ded')">
                    <span data-i18n="header_deductions">Special Deductions (Tax)</span>
                    <span id="arrow-ded">▼</span>
                </div>
                <div class="collapsible-body" id="deduction-body">
                    <div class="row">
                        <div class="col">
                            <label data-i18n="lbl_domestic">Domestic Staff (Mo)</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-domestic" placeholder="0"></div>
                            <div class="smart-hint" id="hint-container-domestic">
                                <span class="hint-text">Cap: <span id="hint-domestic">-</span>/yr</span>
                                <span class="apply-link" onclick="applyMax('ded-domestic', 'val-domestic')" data-i18n="link_apply">Apply Max</span>
                            </div>
                        </div>
                        <div class="col">
                            <label data-i18n="lbl_rent">Rent Paid (Mo)</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-rent" placeholder="0"></div>
                            <div class="smart-hint">
                                <span data-i18n="hint_rent">Cap: 40% (GNI) + 10%</span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label data-i18n="lbl_health">Prepaga (Diff)</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-health" placeholder="0"></div>
                            <div class="smart-hint" id="hint-container-health">
                                <span class="hint-text">Cap: 5% Net</span>
                            </div>
                        </div>
                        <div class="col">
                            <label data-i18n="lbl_life">Life Insurance</label>
                            <div class="input-wrap"><span class="input-prefix">$</span><input type="text" id="ded-life" placeholder="0"></div>
                            <div class="smart-hint" id="hint-container-life">
                                <span class="hint-text">Cap: <span id="hint-life">-</span>/yr</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-calc" onclick="calculate()" data-i18n="btn_calc">Calculate Compensation</button>
        </div>

        <div class="results">
            <div class="summary-card">
                <div class="summary-label" data-i18n="res_label_net">Standard Monthly Net</div>
                <div class="summary-value" id="res-net-main">-</div>
                <div class="summary-sub" id="res-net-sec"></div>
            </div>

            <table class="report-table">
                <thead>
                    <tr>
                        <th data-i18n="th_concept">Concept</th>
                        <th data-i18n="th_monthly">Month</th>
                        <th data-i18n="th_annual">Annual</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-i18n="row_gross">Gross Salary</td>
                        <td id="tbl-gross-m">-</td>
                        <td id="tbl-gross-a">-</td>
                    </tr>
                    <tr id="row-overtime" style="display:none;">
                        <td data-i18n="row_overtime">Overtime (+)</td>
                        <td id="tbl-overtime-m">-</td>
                        <td id="tbl-overtime-a">-</td>
                    </tr>
                    <tr>
                        <td data-i18n="row_social">Social Security</td>
                        <td id="tbl-social-m">-</td>
                        <td id="tbl-social-a">-</td>
                    </tr>
                    <tr id="row-union" style="display:none;">
                        <td data-i18n="row_union">Union / Other</td>
                        <td id="tbl-union-m">-</td>
                        <td id="tbl-union-a">-</td>
                    </tr>
                    <tr>
                        <td data-i18n="row_tax">Income Tax</td>
                        <td id="tbl-tax-m">-</td>
                        <td id="tbl-tax-a">-</td>
                    </tr>
                    <tr class="total-row">
                        <td><strong data-i18n="row_net">Net Income</strong></td>
                        <td id="tbl-net-m" style="font-weight:700; color:var(--primary)">-</td>
                        <td id="tbl-net-a" style="font-weight:700; color:var(--primary)">-</td>
                    </tr>
                </tbody>
            </table>

            <div class="disclaimer">
                <strong data-i18n="lbl_taxable_base">Taxable Base:</strong> <span id="info-tax-base">-</span><br>
                <strong data-i18n="lbl_marginal">Marginal Rate:</strong> <span id="info-marginal">-</span><br><br>
                <span data-i18n="disclaimer_text">Calculations are orientative. Actual values may vary based on exact employment terms, collective bargaining agreements, and monthly prorations.</span>
            </div>
        </div>
    </div>
</div>

<script>
    /* ============================================================================
       1. DATA LAYER (EASY UPDATE SECTION)
       Update these values when laws change. No logic changes needed.
    ============================================================================
    */
    const TAX_DATA_2025 = {
        // Social Security Constants [cite: 7, 8, 9]
        SOCIAL: {
            CAP_BASE: 3731212.01, // Base Imponible Maxima (Dec 2025 proj)
            RATE_JUBILACION: 0.11,
            RATE_PAMI: 0.03,
            RATE_OBRA_SOCIAL: 0.03,
            TOTAL_RATE: 0.17
        },

        // Overtime Divisors [cite: 18, 19]
        OVERTIME: {
            HOURS_DIVISOR: 160, // Standard 20 days * 8 hours
            RATE_50: 1.5,
            RATE_100: 2.0,
            RATE_NIGHT: 1.833
        },

        // Income Tax (Ganancias) - 2nd Semester 2025 (Projected) [cite: 4]
        // Note: Amounts are for the 6-month period. logic annualizes them.
        GANANCIAS: {
            SEMESTER_MULT: 2, // Project to 12 months for calculation
            GNI_SEM: 4211886.94,
            DED_SPECIAL_SEM: 20217057.35,
            DED_SPOUSE_SEM: 3966752.72,
            DED_CHILD_SEM: 2000447.87,
            CAP_LIFE_INS_ANNUAL: 573817.13 * 2,
            
            // Accumulated Scale for 2nd Semester [cite: 4]
            BRACKETS: [
                { limit: 1635136.56, base: 0, rate: 0.05 },
                { limit: 3270273.12, base: 81756.83, rate: 0.09 },
                { limit: 4905409.68, base: 228919.12, rate: 0.12 },
                { limit: 7358114.52, base: 425135.51, rate: 0.15 },
                { limit: 14716229.04, base: 793041.23, rate: 0.19 },
                { limit: 22074343.56, base: 2191083.00, rate: 0.23 },
                { limit: 33111515.34, base: 3883449.33, rate: 0.27 },
                { limit: 49667273.02, base: 6863485.71, rate: 0.31 },
                { limit: Infinity, base: 11995770.59, rate: 0.35 }
            ]
        }
    };

    // --- TRANSLATIONS (Updated with new terms) ---
    const i18n = {
        en: {
            app_title: "Executive Compensation",
            app_subtitle: "Unified Market • Fiscal Year 2025 (Dec Projection)",
            btn_monthly: "Monthly Salary",
            btn_annual: "Annual Package",
            lbl_currency: "Contract Currency",
            opt_ars: "ARS - Pesos",
            opt_usd: "USD - Dollars",
            opt_eur: "EUR - Euros",
            lbl_exchange: "Exchange Rate",
            lbl_gross_monthly: "Gross Monthly Salary",
            lbl_gross_annual: "Gross Annual Package",
            sec_family: "Family Configuration",
            lbl_spouse: "Spouse (No Income)",
            opt_no: "No",
            opt_yes: "Yes",
            lbl_children: "Children (< 18)",
            header_extras: "Overtime & Union",
            lbl_union: "Union / Other (%)",
            hint_union: "Usually 2% - 4% for Unions",
            lbl_overtime_hrs: "Overtime Hrs (50%)",
            header_deductions: "Special Deductions",
            lbl_domestic: "Domestic Staff (Mo)",
            lbl_rent: "Rent Paid (Mo)",
            lbl_health: "Prepaga (Diff)",
            lbl_life: "Life Insurance",
            link_apply: "Apply Max",
            hint_rent: "Cap: 40% (GNI) + 10%",
            btn_calc: "Calculate Compensation",
            res_label_net: "Standard Monthly Net",
            th_concept: "Concept",
            th_monthly: "Standard Month",
            th_annual: "Annual Total",
            row_gross: "Gross Salary",
            row_overtime: "Overtime (+)",
            row_social: "Social Security",
            row_union: "Union / Other",
            row_tax: "Income Tax",
            row_net: "Net Income (ARS)",
            lbl_taxable_base: "Taxable Base (Annualized):",
            lbl_marginal: "Marginal Tax Rate:",
            disclaimer_text: "Calculations are orientative. Values may vary based on unions, agreements, and dates. "
        },
        es: {
            app_title: "Calculadora de Sueldo",
            app_subtitle: "Mercado Unificado • Año Fiscal 2025 (Proy. Dic)",
            btn_monthly: "Sueldo Mensual",
            btn_annual: "Paquete Anual",
            lbl_currency: "Moneda",
            opt_ars: "ARS - Pesos",
            opt_usd: "USD - Dólares",
            opt_eur: "EUR - Euros",
            lbl_exchange: "Tipo de Cambio",
            lbl_gross_monthly: "Sueldo Bruto Mensual",
            lbl_gross_annual: "Paquete Bruto Anual",
            sec_family: "Grupo Familiar",
            lbl_spouse: "Cónyuge (Sin ingresos)",
            opt_no: "No",
            opt_yes: "Sí",
            lbl_children: "Hijos (< 18)",
            header_extras: "Horas Extras y Sindicato",
            lbl_union: "Sindicato / Otros (%)",
            hint_union: "Gralmente 2% - 4% [cite: 10]",
            lbl_overtime_hrs: "Horas Extras (50%)",
            header_deductions: "Deducciones de Ley",
            lbl_domestic: "Servicio Doméstico (Mes)",
            lbl_rent: "Alquiler (Mes)",
            lbl_health: "Prepaga (Excedente)",
            lbl_life: "Seguro de Vida",
            link_apply: "Aplicar Tope",
            hint_rent: "Tope: 40% (GNI) + 10%",
            btn_calc: "Calcular Sueldo Neto",
            res_label_net: "Neto Mensual Estimado",
            th_concept: "Concepto",
            th_monthly: "Mes Estándar",
            th_annual: "Total Anual",
            row_gross: "Sueldo Bruto",
            row_overtime: "Horas Extras (+)",
            row_social: "Jubilación y Obra Soc.",
            row_union: "Sindicato / Otros",
            row_tax: "Impuesto a las Ganancias",
            row_net: "En Mano (ARS)",
            lbl_taxable_base: "Base Imponible (Anualizada):",
            lbl_marginal: "Alícuota Marginal:",
            disclaimer_text: "El resultado es orientativo. Los valores pueden variar según convenio, fecha de pago y prorrateos. "
        }
    };

    let currentLang = 'en';
    let inputMode = 'monthly';
    let dynamicCaps = { 'val-domestic': 0, 'val-health': 0, 'val-edu': 0, 'val-life': 0 };

    function changeLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-opt').forEach(el => el.classList.remove('active'));
        document.querySelector(`.lang-opt[onclick="changeLanguage('${lang}')"]`).classList.add('active');
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if(i18n[lang][key]) el.innerText = i18n[lang][key];
        });
        const labelKey = inputMode === 'annual' ? 'lbl_gross_annual' : 'lbl_gross_monthly';
        document.getElementById('salary-label').innerText = i18n[lang][labelKey];
        updateHints();
    }

    function setMode(mode) {
        inputMode = mode;
        document.querySelectorAll('.toggle-opt').forEach(el => el.classList.remove('active'));
        document.querySelector(`#btn-${mode}`).classList.add('active');
        const labelKey = mode === 'annual' ? 'lbl_gross_annual' : 'lbl_gross_monthly';
        document.getElementById('salary-label').innerText = i18n[currentLang][labelKey];
        updateHints();
    }

    function toggleRateInput() {
        const curr = document.getElementById('currency').value;
        document.getElementById('rate-col').style.display = curr === 'ARS' ? 'none' : 'block';
        document.getElementById('salary-symbol').innerText = curr === 'EUR' ? '€' : '$';
        updateHints();
    }

    function toggleSection(bodyId, arrowId) {
        const body = document.getElementById(bodyId);
        body.classList.toggle('open');
        document.getElementById(arrowId).innerText = body.classList.contains('open') ? '▲' : '▼';
    }

    function parseNumber(val) {
        if (!val) return 0;
        let clean = val.toString().replace(/\./g, '').replace(/,/g, '.');
        return parseFloat(clean) || 0;
    }

    function updateHints() {
        const fmt = (n) => new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS', maximumFractionDigits: 0 }).format(n);
        const gniAnnual = TAX_DATA_2025.GANANCIAS.GNI_SEM * TAX_DATA_2025.GANANCIAS.SEMESTER_MULT;
        
        dynamicCaps['val-domestic'] = gniAnnual / 12;
        setHintText('hint-domestic', 'hint-container-domestic', fmt(gniAnnual));

        const capLife = TAX_DATA_2025.GANANCIAS.CAP_LIFE_INS_ANNUAL;
        dynamicCaps['val-life'] = capLife / 12;
        setHintText('hint-life', 'hint-container-life', fmt(capLife));
    }

    function setHintText(valueSpanId, containerId, value) {
        document.getElementById(valueSpanId).innerText = value;
    }

    function applyMax(inputId, valKey) {
        const val = dynamicCaps[valKey];
        if(val > 0) document.getElementById(inputId).value = new Intl.NumberFormat('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(val);
    }

    function calculate() {
        // --- 1. GATHER INPUTS ---
        const currency = document.getElementById('currency').value;
        const salaryInput = parseNumber(document.getElementById('salary-input').value);
        const rate = parseNumber(document.getElementById('exchange-rate').value) || 1;
        if(salaryInput === 0) return;

        // Convert everything to ARS Monthly first
        const rawArs = currency === 'ARS' ? salaryInput : salaryInput * rate;
        let baseGrossMonthly = inputMode === 'annual' ? rawArs / 13 : rawArs;

        // --- 2. ADD OVERTIME [cite: 16, 17, 18, 19] ---
        const otHours = parseFloat(document.getElementById('overtime-50').value) || 0;
        let otAmountMonthly = 0;
        if (otHours > 0) {
            const hourlyRate = baseGrossMonthly / TAX_DATA_2025.OVERTIME.HOURS_DIVISOR;
            otAmountMonthly = hourlyRate * TAX_DATA_2025.OVERTIME.RATE_50 * otHours;
        }

        const totalGrossMonthly = baseGrossMonthly + otAmountMonthly;
        // Annualize (Gross * 12 + SAC)
        // Note: SAC (Aguinaldo) is 1/12 of the total earnings
        const sacAmount = totalGrossMonthly; // 1 month equiv
        const totalGrossAnnual = (totalGrossMonthly * 12) + sacAmount;

        // --- 3. DEDUCTIONS: SOCIAL SECURITY ---
        // Cap applies to the base, usually implies on OT too up to cap
        const ssBase = Math.min(totalGrossMonthly, TAX_DATA_2025.SOCIAL.CAP_BASE);
        const ssMonthly = ssBase * TAX_DATA_2025.SOCIAL.TOTAL_RATE;
        
        const ssSacBase = Math.min(sacAmount, TAX_DATA_2025.SOCIAL.CAP_BASE / 2); // SAC cap is 50%
        const ssSacTotal = (ssSacBase * TAX_DATA_2025.SOCIAL.TOTAL_RATE) * 2; // Jun + Dec
        const ssAnnual = (ssMonthly * 12) + ssSacTotal;

        // --- 4. DEDUCTIONS: UNION / OTHER  ---
        // Union is usually a % of the TOTAL Gross (Uncapped), and is deductible for Tax
        const unionPct = parseNumber(document.getElementById('union-pct').value);
        const unionMonthly = totalGrossMonthly * (unionPct / 100);
        const unionAnnual = unionMonthly * 13; // Applies on SAC too usually

        // --- 5. INCOME TAX (GANANCIAS) ---
        // Net Cumulative = Gross - Social - Union
        const netCumulativeAnnual = totalGrossAnnual - ssAnnual - unionAnnual;

        // Personal Deductions
        const children = parseInt(document.getElementById('children').value) || 0;
        const hasSpouse = document.getElementById('spouse').value === "1";
        const G = TAX_DATA_2025.GANANCIAS; // Shortcut
        const mult = G.SEMESTER_MULT;

        let dedPersonal = (G.GNI_SEM * mult) + (G.DED_SPECIAL_SEM * mult);
        if(hasSpouse) dedPersonal += (G.DED_SPOUSE_SEM * mult);
        dedPersonal += (children * (G.DED_CHILD_SEM * mult));

        // General Deductions
        const valDomestic = parseNumber(document.getElementById('ded-domestic').value) * 12;
        const valRent = parseNumber(document.getElementById('ded-rent').value) * 12;
        const valHealth = parseNumber(document.getElementById('ded-health').value) * 12;
        const valLife = parseNumber(document.getElementById('ded-life').value) * 12;

        const dedDomestic = Math.min(valDomestic, (G.GNI_SEM * mult));
        // Rent Logic: 10% of value, capped at 40% GNI
        const rentCap = (G.GNI_SEM * mult) * 0.40;
        const dedRent = Math.min(valRent * 0.10, rentCap);
        const dedLife = Math.min(valLife, G.CAP_LIFE_INS_ANNUAL);

        // Health Cap (5% of Net Income before Health)
        const intermediateBase = netCumulativeAnnual - dedPersonal - dedDomestic - dedRent - dedLife;
        const capHealth = Math.max(0, intermediateBase * 0.05);
        const dedHealth = Math.min(valHealth, capHealth);

        const finalTaxableAnnual = Math.max(0, intermediateBase - dedHealth);

        // Calculate Tax
        const taxResult = calculateTax(finalTaxableAnnual, G.BRACKETS, mult);
        const taxAnnual = taxResult.tax;
        const taxMonthly = taxAnnual / 12; 

        // --- 6. DISPLAY RESULTS ---
        const totalDedMonthly = ssMonthly + unionMonthly + taxMonthly;
        const netMonthly = totalGrossMonthly - totalDedMonthly;

        const fmtArs = new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS', maximumFractionDigits: 0 });
        const fmtForeign = new Intl.NumberFormat('en-US', { style: 'currency', currency: currency, maximumFractionDigits: 0 });

        // Main Number
        if(currency === 'ARS') {
            document.getElementById('res-net-main').innerText = fmtArs.format(netMonthly);
            document.getElementById('res-net-sec').innerText = "";
        } else {
            document.getElementById('res-net-main').innerText = fmtForeign.format(netMonthly / rate);
            document.getElementById('res-net-sec').innerText = "≈ " + fmtArs.format(netMonthly);
        }

        // Table updates
        setText('tbl-gross-m', fmtArs.format(baseGrossMonthly));
        setText('tbl-gross-a', fmtArs.format(baseGrossMonthly * 13)); // Simple projection
        
        // Handle Overtime Rows
        if(otAmountMonthly > 0) {
            document.getElementById('row-overtime').style.display = 'table-row';
            setText('tbl-overtime-m', fmtArs.format(otAmountMonthly));
            setText('tbl-overtime-a', fmtArs.format(otAmountMonthly * 13));
        } else {
            document.getElementById('row-overtime').style.display = 'none';
        }

        // Handle Union Rows
        if(unionMonthly > 0) {
            document.getElementById('row-union').style.display = 'table-row';
            setText('tbl-union-m', fmtArs.format(unionMonthly));
            setText('tbl-union-a', fmtArs.format(unionAnnual));
        } else {
            document.getElementById('row-union').style.display = 'none';
        }

        setText('tbl-social-m', fmtArs.format(ssMonthly));
        setText('tbl-social-a', fmtArs.format(ssAnnual));
        setText('tbl-tax-m', fmtArs.format(taxMonthly));
        setText('tbl-tax-a', fmtArs.format(taxAnnual));
        setText('tbl-net-m', fmtArs.format(netMonthly));
        setText('tbl-net-a', fmtArs.format((netMonthly * 12) + (netMonthly))); // Approx

        // Breakdown Info
        setText('info-tax-base', fmtArs.format(finalTaxableAnnual));
        document.getElementById('info-marginal').innerText = (taxResult.rate * 100).toFixed(0) + "%";
    }

    function calculateTax(income, brackets, multiplier) {
        if (income <= 0) return { tax: 0, rate: 0 };
        let tax = 0;
        let marginalRate = 0;
        let previousLimit = 0;

        for (let b of brackets) {
            // Adjust bracket limits by multiplier (Semester -> Annual)
            const limit = b.limit === Infinity ? Infinity : b.limit * multiplier;
            
            if (income > limit) {
                tax += (limit - previousLimit) * b.rate;
                previousLimit = limit;
            } else {
                tax += (income - previousLimit) * b.rate;
                marginalRate = b.rate;
                break;
            }
            marginalRate = b.rate; // Catch-all for top bracket
        }
        return { tax, rate: marginalRate };
    }

    function setText(id, val) { document.getElementById(id).innerText = val; }

    // Input Masking
    document.querySelectorAll('input[type="text"]').forEach(input => {
        input.addEventListener('input', (e) => {
            let val = e.target.value.replace(/[^0-9,]/g, ''); 
            let parts = val.split(',');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            e.target.value = parts.join(',');
        });
    });

    updateHints();
</script>

</body>
</html>
